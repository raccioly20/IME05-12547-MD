{
  "hash": "5508891cadd22c85e6d283407c605de7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Manipulação dos dados\"\nauthor: \"Ricardo Accioly\"\ndate: \"2024-08-20\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\nexecute:\n  freeze: auto\n---\n\n\n\n\n## Carregando bibliotescas\n\nVamos trabalhar de novo com os dados do gapminder para fazer algumas manipulações de dados que são muito úteis no dia a dia.\n\nEste material foi em parte adaptado do curso Data Visualization in R with ggplot2 de Kara Woo\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"gapminder\")\nlibrary(\"dplyr\")\nlibrary(\"ggplot2\")\nlibrary(\"patchwork\")\n```\n:::\n\n\n\n\n## Filtrando 2007\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Cria um extrato do ano de 2007\ndata(gapminder)\nsummary(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>         country        continent        year         lifeExp     \n#>  Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.60  \n#>  Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.20  \n#>  Algeria    :  12   Asia    :396   Median :1980   Median :60.71  \n#>  Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.47  \n#>  Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.85  \n#>  Australia  :  12                  Max.   :2007   Max.   :82.60  \n#>  (Other)    :1632                                                \n#>       pop              gdpPercap       \n#>  Min.   :6.001e+04   Min.   :   241.2  \n#>  1st Qu.:2.794e+06   1st Qu.:  1202.1  \n#>  Median :7.024e+06   Median :  3531.8  \n#>  Mean   :2.960e+07   Mean   :  7215.3  \n#>  3rd Qu.:1.959e+07   3rd Qu.:  9325.5  \n#>  Max.   :1.319e+09   Max.   :113523.1  \n#> \n```\n\n\n:::\n\n```{.r .cell-code}\ngap_07 <- filter(gapminder, year == 2007)\n```\n:::\n\n\n\n\n## Vendo primeiras e últimas 10 linhas\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(gap_07, n=10) %>% knitr::kable(booktabs = TRUE) # primeiros dez paises da base de dados\n```\n\n::: {.cell-output-display}\n\n\n|country     |continent | year| lifeExp|       pop|  gdpPercap|\n|:-----------|:---------|----:|-------:|---------:|----------:|\n|Afghanistan |Asia      | 2007|  43.828|  31889923|   974.5803|\n|Albania     |Europe    | 2007|  76.423|   3600523|  5937.0295|\n|Algeria     |Africa    | 2007|  72.301|  33333216|  6223.3675|\n|Angola      |Africa    | 2007|  42.731|  12420476|  4797.2313|\n|Argentina   |Americas  | 2007|  75.320|  40301927| 12779.3796|\n|Australia   |Oceania   | 2007|  81.235|  20434176| 34435.3674|\n|Austria     |Europe    | 2007|  79.829|   8199783| 36126.4927|\n|Bahrain     |Asia      | 2007|  75.635|    708573| 29796.0483|\n|Bangladesh  |Asia      | 2007|  64.062| 150448339|  1391.2538|\n|Belgium     |Europe    | 2007|  79.441|  10392226| 33692.6051|\n\n\n:::\n\n```{.r .cell-code}\ntail(gap_07, n=10) %>% knitr::kable(booktabs = TRUE) # últimos 10 países \n```\n\n::: {.cell-output-display}\n\n\n|country            |continent | year| lifeExp|       pop|  gdpPercap|\n|:------------------|:---------|----:|-------:|---------:|----------:|\n|Uganda             |Africa    | 2007|  51.542|  29170398|  1056.3801|\n|United Kingdom     |Europe    | 2007|  79.425|  60776238| 33203.2613|\n|United States      |Americas  | 2007|  78.242| 301139947| 42951.6531|\n|Uruguay            |Americas  | 2007|  76.384|   3447496| 10611.4630|\n|Venezuela          |Americas  | 2007|  73.747|  26084662| 11415.8057|\n|Vietnam            |Asia      | 2007|  74.249|  85262356|  2441.5764|\n|West Bank and Gaza |Asia      | 2007|  73.422|   4018332|  3025.3498|\n|Yemen, Rep.        |Asia      | 2007|  62.698|  22211743|  2280.7699|\n|Zambia             |Africa    | 2007|  42.384|  11746035|  1271.2116|\n|Zimbabwe           |Africa    | 2007|  43.487|  12311143|   469.7093|\n\n\n:::\n:::\n\n\n\n\n## Manipulando 1\n\nSelecionando dados por país\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter(gap_07, country %in% c(\"Brazil\", \"Chile\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 2 × 6\n#>   country continent  year lifeExp       pop gdpPercap\n#>   <fct>   <fct>     <int>   <dbl>     <int>     <dbl>\n#> 1 Brazil  Americas   2007    72.4 190010647     9066.\n#> 2 Chile   Americas   2007    78.6  16284741    13172.\n```\n\n\n:::\n:::\n\n\n\n\n## Manipulando 2\n\nSelecionando dados para 2007 excluindo a Oceania\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter(gapminder, year == 2007 & continent != \"Oceania\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 140 × 6\n#>    country     continent  year lifeExp       pop gdpPercap\n#>    <fct>       <fct>     <int>   <dbl>     <int>     <dbl>\n#>  1 Afghanistan Asia       2007    43.8  31889923      975.\n#>  2 Albania     Europe     2007    76.4   3600523     5937.\n#>  3 Algeria     Africa     2007    72.3  33333216     6223.\n#>  4 Angola      Africa     2007    42.7  12420476     4797.\n#>  5 Argentina   Americas   2007    75.3  40301927    12779.\n#>  6 Austria     Europe     2007    79.8   8199783    36126.\n#>  7 Bahrain     Asia       2007    75.6    708573    29796.\n#>  8 Bangladesh  Asia       2007    64.1 150448339     1391.\n#>  9 Belgium     Europe     2007    79.4  10392226    33693.\n#> 10 Benin       Africa     2007    56.7   8078314     1441.\n#> # ℹ 130 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Manipulando 3\n\nSelecionando dados de 2007, agrupando por continente e sumarizando para achar a média da população por continente\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder %>%\n  filter(year == 2007) %>% \n  group_by(continent) %>% \n  summarize(mediapop = mean(pop))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 5 × 2\n#>   continent   mediapop\n#>   <fct>          <dbl>\n#> 1 Africa     17875763.\n#> 2 Americas   35954847.\n#> 3 Asia      115513752.\n#> 4 Europe     19536618.\n#> 5 Oceania    12274974.\n```\n\n\n:::\n:::\n\n\n\n\n## Visualizando 1\n\nMostrar linhas e pontos do PIB ao longo do tempo para Brasil e Chile\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngap_brachi <- filter(gapminder, country %in% c(\"Brazil\", \"Chile\"))\np <- ggplot(gap_brachi, aes(x = year, y = gdpPercap, color=country))\np1 <- p + geom_point()\np1\n```\n\n::: {.cell-output-display}\n![](Aula02_files/figure-html/graf1-1.png){width=90%}\n:::\n:::\n\n\n\n\n## Visualizando 2\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- p + geom_line()\np2\n```\n\n::: {.cell-output-display}\n![](Aula02_files/figure-html/graf2-1.png){width=90%}\n:::\n:::\n\n\n\n\n## Visualizando 3\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- p + geom_point() + geom_line()\np3\n```\n\n::: {.cell-output-display}\n![](Aula02_files/figure-html/graf3-1.png){width=90%}\n:::\n:::\n\n\n\n\n## Visualizando 4 - Usando o pacote patchwork\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(p1 + p2) /\n  p3\n```\n\n::: {.cell-output-display}\n![](Aula02_files/figure-html/graf4-1.png){width=90%}\n:::\n:::\n\n\n\n\n## Manipulando 4\n\nContando número de países e continentes com distinct\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(gapminder) ## Esta não é a informação que eu quero\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 1704\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 6\n#>   country     continent  year lifeExp      pop gdpPercap\n#>   <fct>       <fct>     <int>   <dbl>    <int>     <dbl>\n#> 1 Afghanistan Asia       1952    28.8  8425333      779.\n#> 2 Afghanistan Asia       1957    30.3  9240934      821.\n#> 3 Afghanistan Asia       1962    32.0 10267083      853.\n#> 4 Afghanistan Asia       1967    34.0 11537966      836.\n#> 5 Afghanistan Asia       1972    36.1 13079460      740.\n#> 6 Afghanistan Asia       1977    38.4 14880372      786.\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(distinct(gapminder,country))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 142\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(distinct(gapminder, continent))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 5\n```\n\n\n:::\n:::\n\n\n\n\n## Fazendo contagens de dados\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder %>% filter(year == 2007) %>% \n  group_by(continent) %>% summarise(n = n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 5 × 2\n#>   continent     n\n#>   <fct>     <int>\n#> 1 Africa       52\n#> 2 Americas     25\n#> 3 Asia         33\n#> 4 Europe       30\n#> 5 Oceania       2\n```\n\n\n:::\n:::\n\n\n\n\n## Mudando orientação dos dados\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\npropaganda <- read_excel(\"Propaganda.xlsx\")\nhead(propaganda)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 4\n#>      TV Radio Newspaper Sales\n#>   <dbl> <dbl>     <dbl> <dbl>\n#> 1 230.   37.8      69.2  22.1\n#> 2  44.5  39.3      45.1  10.4\n#> 3  17.2  45.9      69.3   9.3\n#> 4 152.   41.3      58.5  18.5\n#> 5 181.   10.8      58.4  12.9\n#> 6   8.7  48.9      75     7.2\n```\n\n\n:::\n\n```{.r .cell-code}\npropaganda <- propaganda %>% rename(Jornal = Newspaper, Vendas = Sales)\npropaganda %>% tidyr::pivot_longer(!Vendas, names_to=\"Midia\", values_to=\"Orcamento\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 600 × 3\n#>    Vendas Midia  Orcamento\n#>     <dbl> <chr>      <dbl>\n#>  1   22.1 TV         230. \n#>  2   22.1 Radio       37.8\n#>  3   22.1 Jornal      69.2\n#>  4   10.4 TV          44.5\n#>  5   10.4 Radio       39.3\n#>  6   10.4 Jornal      45.1\n#>  7    9.3 TV          17.2\n#>  8    9.3 Radio       45.9\n#>  9    9.3 Jornal      69.3\n#> 10   18.5 TV         152. \n#> # ℹ 590 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\npesquisa <- read.csv(\"data_joined.csv\", header = T)\nhead(pesquisa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>   record_id month day year plot_id species_id sex hindfoot_length weight\n#> 1         1     7  16 1977       2         NL   M              32     NA\n#> 2        72     8  19 1977       2         NL   M              31     NA\n#> 3       224     9  13 1977       2         NL                  NA     NA\n#> 4       266    10  16 1977       2         NL                  NA     NA\n#> 5       349    11  12 1977       2         NL                  NA     NA\n#> 6       363    11  12 1977       2         NL                  NA     NA\n#>     genus  species   taxa plot_type\n#> 1 Neotoma albigula Rodent   Control\n#> 2 Neotoma albigula Rodent   Control\n#> 3 Neotoma albigula Rodent   Control\n#> 4 Neotoma albigula Rodent   Control\n#> 5 Neotoma albigula Rodent   Control\n#> 6 Neotoma albigula Rodent   Control\n```\n\n\n:::\n\n```{.r .cell-code}\npesquisa_gw <- pesquisa %>% filter(!is.na(weight)) %>%\n  group_by(year, genus) %>%\n  summarize(peso_medio = mean(weight))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n#> `summarise()` has grouped output by 'year'. You can override using the\n#> `.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(pesquisa_gw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 6 × 3\n#> # Groups:   year [1]\n#>    year genus           peso_medio\n#>   <int> <chr>                <dbl>\n#> 1  1977 Chaetodipus          15.3 \n#> 2  1977 Dipodomys            52.5 \n#> 3  1977 Onychomys            21.4 \n#> 4  1977 Perognathus           7.17\n#> 5  1977 Peromyscus           19.5 \n#> 6  1977 Reithrodontomys      10\n```\n\n\n:::\n\n```{.r .cell-code}\npesquisa_gw %>% tidyr::pivot_wider(names_from=\"genus\", values_from=\"peso_medio\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> # A tibble: 26 × 11\n#> # Groups:   year [26]\n#>     year Chaetodipus Dipodomys Onychomys Perognathus Peromyscus Reithrodontomys\n#>    <int>       <dbl>     <dbl>     <dbl>       <dbl>      <dbl>           <dbl>\n#>  1  1977        15.3      52.5      21.4        7.17       19.5           10   \n#>  2  1978        14.9      73.9      26.5        7.09       20.5            7.5 \n#>  3  1979        15.1      74.9      27.4        7.53       21.3            8.33\n#>  4  1980        14.2      73.1      28.3        7.46       22.4           10.2 \n#>  5  1981        14.0      72.7      28.4        7.15       20.4           11.2 \n#>  6  1982        16.1      66.3      29.9        6.92       21.3           10.5 \n#>  7  1983        15.5      65.0      29.0        6.83       21.5            9.87\n#>  8  1984        15.3      52.8      28.3       16.9        20.0           11.2 \n#>  9  1985        15.8      51.1      28.1       32.7        20.0            8.37\n#> 10  1986        16.8      56.4      27.5       18.3        22.1           10.8 \n#> # ℹ 16 more rows\n#> # ℹ 4 more variables: Neotoma <dbl>, Sigmodon <dbl>, Spermophilus <dbl>,\n#> #   Baiomys <dbl>\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Aula02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}