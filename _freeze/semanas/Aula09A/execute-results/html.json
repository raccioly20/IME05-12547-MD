{
  "hash": "00bcb17beca3451a2e7745e0b3abecb9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Regressão Logística - SMOTE\"\nauthor: \"Ricardo Accioly\"\ndate: \"2024-05-10\"\nformat:\n html:\n    code-link: true\n---\n\n\n## Carregando Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ISLR)\ndata(Default)\nsummary(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n default    student       balance           income     \n No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n                       Median : 823.6   Median :34553  \n                       Mean   : 835.4   Mean   :33517  \n                       3rd Qu.:1166.3   3rd Qu.:43808  \n                       Max.   :2654.3   Max.   :73554  \n```\n\n\n:::\n\n```{.r .cell-code}\nstr(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t10000 obs. of  4 variables:\n $ default: Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n $ student: Factor w/ 2 levels \"No\",\"Yes\": 1 2 1 1 1 2 1 2 1 1 ...\n $ balance: num  730 817 1074 529 786 ...\n $ income : num  44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  default student   balance    income\n1      No      No  729.5265 44361.625\n2      No     Yes  817.1804 12106.135\n3      No      No 1073.5492 31767.139\n4      No      No  529.2506 35704.494\n5      No      No  785.6559 38463.496\n6      No     Yes  919.5885  7491.559\n```\n\n\n:::\n:::\n\n\n## Manipulando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncredito <- tibble(Default)\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n default    student       balance           income     \n No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n                       Median : 823.6   Median :34553  \n                       Mean   : 835.4   Mean   :33517  \n                       3rd Qu.:1166.3   3rd Qu.:43808  \n                       Max.   :2654.3   Max.   :73554  \n```\n\n\n:::\n\n```{.r .cell-code}\n# renomeando colunas\ncredito <- credito %>% \n                rename( inadimplente = default, estudante = student, balanco = balance,\n                receita = income)\ncredito <- credito %>% mutate( inadimplente =  case_when(\n                           inadimplente == \"No\"  ~ \"Nao\",\n                           inadimplente == \"Yes\" ~ \"Sim\"\n                          )) %>% mutate(inadimplente = factor(inadimplente))\ncredito <- credito %>% mutate( estudante =  case_when(\n                           estudante == \"No\"  ~ 0,\n                           estudante == \"Yes\" ~ 1\n                          ))\n\nstr(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [10,000 × 4] (S3: tbl_df/tbl/data.frame)\n $ inadimplente: Factor w/ 2 levels \"Nao\",\"Sim\": 1 1 1 1 1 1 1 1 1 1 ...\n $ estudante   : num [1:10000] 0 1 0 0 0 1 0 1 0 0 ...\n $ balanco     : num [1:10000] 730 817 1074 529 786 ...\n $ receita     : num [1:10000] 44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n inadimplente   estudante         balanco          receita     \n Nao:9667     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n Sim: 333     1st Qu.:0.0000   1st Qu.: 481.7   1st Qu.:21340  \n              Median :0.0000   Median : 823.6   Median :34553  \n              Mean   :0.2944   Mean   : 835.4   Mean   :33517  \n              3rd Qu.:1.0000   3rd Qu.:1166.3   3rd Qu.:43808  \n              Max.   :1.0000   Max.   :2654.3   Max.   :73554  \n```\n\n\n:::\n:::\n\n\n## Treino e Teste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(caret)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: lattice\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAnexando pacote: 'caret'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nO seguinte objeto é mascarado por 'package:purrr':\n\n    lift\n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(21)\ny <- credito$inadimplente\nindice_teste <- createDataPartition(y, times = 1, p = 0.2, list = FALSE)\n\nconj_treino <- credito %>% slice(-indice_teste)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Slicing with a 1-column matrix was deprecated in dplyr 1.1.0.\n```\n\n\n:::\n\n```{.r .cell-code}\nconj_teste <- credito %>% slice(indice_teste)\n\nsummary(conj_treino)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n inadimplente   estudante         balanco          receita     \n Nao:7733     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n Sim: 266     1st Qu.:0.0000   1st Qu.: 481.3   1st Qu.:21339  \n              Median :0.0000   Median : 819.1   Median :34541  \n              Mean   :0.2953   Mean   : 832.7   Mean   :33541  \n              3rd Qu.:1.0000   3rd Qu.:1167.1   3rd Qu.:43840  \n              Max.   :1.0000   Max.   :2654.3   Max.   :73554  \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_teste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n inadimplente   estudante         balanco          receita     \n Nao:1934     Min.   :0.0000   Min.   :   0.0   Min.   : 4755  \n Sim:  67     1st Qu.:0.0000   1st Qu.: 483.5   1st Qu.:21371  \n              Median :0.0000   Median : 836.6   Median :34591  \n              Mean   :0.2909   Mean   : 846.2   Mean   :33423  \n              3rd Qu.:1.0000   3rd Qu.:1163.1   3rd Qu.:43646  \n              Max.   :1.0000   Max.   :2461.5   Max.   :71239  \n```\n\n\n:::\n:::\n\n\n## SMOTE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(smotefamily)\nset.seed(123)\nteste <- SMOTE(conj_treino[,-1], target = conj_treino$inadimplente, K=5)\nconj_treinoS <- teste$data\nconj_treinoS$class <- as.factor(conj_treinoS$class)\nconj_treinoS <- conj_treinoS %>% rename( inadimplente = class)\nprop.table(table(conj_treinoS$inadimplente))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Nao      Sim \n0.500615 0.499385 \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_treinoS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   estudante         balanco          receita      inadimplente\n Min.   :0.0000   Min.   :   0.0   Min.   :  772   Nao:7733    \n 1st Qu.:0.0000   1st Qu.: 795.5   1st Qu.:20166   Sim:7714    \n Median :0.0000   Median :1392.3   Median :33703               \n Mean   :0.3394   Mean   :1272.9   Mean   :32841               \n 3rd Qu.:1.0000   3rd Qu.:1769.2   3rd Qu.:43745               \n Max.   :1.0000   Max.   :2654.3   Max.   :73554               \n```\n\n\n:::\n:::\n\n\n## 1a Regressão logística\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- glm(inadimplente ~ balanco + receita + estudante,data=conj_treinoS,family=binomial)\nsummary(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = inadimplente ~ balanco + receita + estudante, family = binomial, \n    data = conj_treinoS)\n\nCoefficients:\n              Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -9.778e+00  2.279e-01 -42.898  < 2e-16 ***\nbalanco      7.115e-03  1.199e-04  59.356  < 2e-16 ***\nreceita      9.409e-06  3.645e-06   2.582  0.00984 ** \nestudante   -6.092e-01  1.071e-01  -5.688 1.28e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 21414.1  on 15446  degrees of freedom\nResidual deviance:  7490.3  on 15443  degrees of freedom\nAIC: 7498.3\n\nNumber of Fisher Scoring iterations: 7\n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  (Intercept)       balanco       receita     estudante \n-9.778189e+00  7.114940e-03  9.409475e-06 -6.092070e-01 \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(mod1)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Estimate   Std. Error    z value     Pr(>|z|)\n(Intercept) -9.778189e+00 2.279388e-01 -42.898311 0.000000e+00\nbalanco      7.114940e-03 1.198694e-04  59.355775 0.000000e+00\nreceita      9.409475e-06 3.644856e-06   2.581576 9.835023e-03\nestudante   -6.092070e-01 1.070945e-01  -5.688499 1.281605e-08\n```\n\n\n:::\n:::\n\n\n## Avaliando o modelo novamente\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop.table(table(conj_teste$inadimplente))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n       Nao        Sim \n0.96651674 0.03348326 \n```\n\n\n:::\n\n```{.r .cell-code}\np_chapeu <- predict(mod1, newdata = conj_teste, type = \"response\")\ny_chapeu <- ifelse(p_chapeu > 0.5, \"Sim\", \"Nao\") %>% factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(y_chapeu, conj_teste$inadimplente, positive=\"Sim\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction  Nao  Sim\n       Nao 1696   11\n       Sim  238   56\n                                          \n               Accuracy : 0.8756          \n                 95% CI : (0.8603, 0.8897)\n    No Information Rate : 0.9665          \n    P-Value [Acc > NIR] : 1               \n                                          \n                  Kappa : 0.2705          \n                                          \n Mcnemar's Test P-Value : <2e-16          \n                                          \n            Sensitivity : 0.83582         \n            Specificity : 0.87694         \n         Pos Pred Value : 0.19048         \n         Neg Pred Value : 0.99356         \n             Prevalence : 0.03348         \n         Detection Rate : 0.02799         \n   Detection Prevalence : 0.14693         \n      Balanced Accuracy : 0.85638         \n                                          \n       'Positive' Class : Sim             \n                                          \n```\n\n\n:::\n:::\n\n\n## Curva ROC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\np_chapeu_log <- predict(mod1, newdata = conj_teste, type = \"response\")\nhead(p_chapeu_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           1            2            3            4            5            6 \n1.710555e-01 3.991424e-04 9.094011e-05 9.398313e-02 3.185776e-03 8.710220e-04 \n```\n\n\n:::\n\n```{.r .cell-code}\nroc_log <- roc(conj_teste$inadimplente ~ p_chapeu_log, plot = TRUE, print.auc=TRUE,\n                 legacy.axes=TRUE) \n```\n\n::: {.cell-output-display}\n![](Aula09A_files/figure-html/ROC-1.png){width=864}\n:::\n\n```{.r .cell-code}\nas.numeric(roc_log$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.941186\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Aula09A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}