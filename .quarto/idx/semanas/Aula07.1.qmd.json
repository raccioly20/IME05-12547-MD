{"title":"Regressão Linear","markdown":{"yaml":{"title":"Regressão Linear","author":"Ricardo Accioly","date":"`r Sys.Date()`","output":{"html_document":{"toc":"yes","code_download":"yes"}}},"headingText":"Carregando bibliotecas","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(fig.width = 8, \n                      fig.height= 5,  \n                      fig.retina = 3,\n                      message = FALSE, \n                      warning = FALSE,\n                      dev=c(\"png\"), \n                      fig.path=\"imagens/Aula07_1/\")\n```\n\n\n```{r}\nlibrary(tidyverse)\n```\n\n## Dados de propaganda\n\nO conjunto de dados contém estatísticas sobre as vendas de um produto em 200 diferentes mercados, juntamente com orçamentos publicitários em cada um desses mercados, para diferentes canais de mídia: TV, rádio e jornal. As vendas estão em milhares de unidades e o orçamento está em milhares de dólares.\n\n```{r carrega-dados}\nlibrary(readxl)\npropaganda <- read_excel(\"Propaganda.xlsx\")\nsummary(propaganda)\n```\n\n## Renomeando\n\n```{r renomeando}\npropaganda <- propaganda %>% rename(Jornal = Newspaper, Vendas = Sales)\n\n```\n\n## Sumario\n\n```{r sumario}\nsummary(propaganda)\nnrow(propaganda)\n```\n\n## Linhas inicias\n\n```{r head}\nlibrary(gt)\ngt(head(propaganda, 10))\n```\n\n## Criando amostra de treino e teste\n\n```{r treino_teste, message=FALSE}\nlibrary(caret)\nset.seed(21)\ny <- propaganda$Vendas\nindice_teste <- createDataPartition(y, times = 1, p = 0.40, list = FALSE)\n\nconj_treino <- propaganda %>% slice(-indice_teste)\nconj_teste <- propaganda %>% slice(indice_teste)\n\nstr(conj_treino)\nstr(conj_teste)\ngt(head(conj_treino, 10))\n```\n\n## Primeira visualização dos dados\n\nAqui estou usando uma função do pacote caret que de uma maneira simples apresenta a relação entre a variável resposta e suas possíveis variáveis explicativas\n\n```{r caret}\nfeaturePlot(x = conj_treino[ , c(\"TV\", \"Radio\", \"Jornal\")], y = conj_treino$Vendas)\n```\n\n## Usando o ggplot\n\n```{r ggplot}\ngt(head(conj_treino, 10))\nc_treino_pivot <- conj_treino %>% pivot_longer(!Vendas, names_to=\"Tipo\", values_to=\"Orçamento\" ) \ngt(head(c_treino_pivot, 10))\nconj_treino %>% pivot_longer(!Vendas, names_to=\"Tipo\", values_to=\"Orçamento\" ) %>%\n            ggplot() + \n            geom_point(aes(x=Orçamento, y=Vendas)) +\n            facet_wrap( ~ Tipo, scales = \"free_x\") +\n            labs(x = \"Orçamento (1000 US$)\", \n                 y = \"Vendas (em 1000 unidades vendidas)\", \n                 title = \"Vendas vs Propaganda\"\n                 ) \n```\n\n\\newpage\n\n## Matriz de dispersão\n\n```{r splom, message=FALSE}\nlibrary(psych)\npairs.panels(conj_treino, \n             method = \"pearson\", # metodo de correlação\n             hist.col = \"#00AFBB\",\n             density = TRUE,  # mostra graficos de densidade\n             ellipses = FALSE # mostra elipses de correlação\n             )\n\n```\n\n\\newpage\n\n## 1o Mod Regressão\n\n```{r 1a_regressão, message=FALSE}\nmod1 <- lm( Vendas ~ TV, data = conj_treino)\nnames(mod1)\ncoeflinear <- mod1$coefficients[1]\ncoefang <- mod1$coefficients[2]\nsummary(mod1)\nggplot(conj_treino, aes(x=TV, y=Vendas)) +\n    geom_point() +\n    geom_abline(slope = coefang,intercept = coeflinear, color=\"blue\" ) + \n    geom_hline(yintercept=coeflinear, linetype=\"dashed\", color = \"red\")\n\n```\n\n## Outra forma de representação do 1o Modelo\n\n```{r 1areg, message=FALSE}\nlibrary(car)\nscatterplot(Vendas ~ TV, data = conj_treino, smooth=F, id.n=1)\n```\n\n## Extraindo informações do 1o ajuste\n\n```{r 1areg_info}\nsummary(mod1)$sigma\nsummary(mod1)$r.squared\n```\n\n## Intervalo de Confiança\n\n```{r IC}\nsummary(mod1)\nconfint(mod1)\n```\n\n## Anova\n\n```{r anova}\nanova(mod1)\n```\n\n## Previsões\n\n```{r previsoes}\n#?predict\npredict(mod1, data.frame(TV=c(50, 150, 250)), interval = \"prediction\")\n```\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r avaliando_TV}\nsqrt(mean((conj_teste$Vendas - predict(mod1, conj_teste)) ^ 2)) \n```\n\n## Análise do modelo\n\n```{r residuos1a, message=FALSE}\nplot(mod1)\n```\n\n## Análise do modelo 2\n\n```{r residuos1b, message=FALSE, fig.height= 7}\nlibrary(performance)\ncheck_model(mod1)\n```\n\n## 2o Modelo de Regressão\n\n```{r 2modelo-regressão, fig.height= 5}\nmod2 <- lm( Vendas ~ Radio, data = conj_treino)\ncoeflinear <- mod2$coefficients[1]\ncoefang <- mod2$coefficients[2]\nsummary(mod2)\nggplot(propaganda, aes(x=Radio, y=Vendas)) +\n    geom_point() +\n    geom_abline(slope = coefang,intercept = coeflinear, color=\"blue\" ) + \n    geom_hline(yintercept=coeflinear, linetype=\"dashed\", color = \"red\")\n```\n\n## Outra forma de representação do 2o Modelo\n\n```{r 2areg, message=FALSE}\nscatterplot(Vendas ~ Radio, data = conj_treino, smooth=F, id.n=1)\n```\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r avaliando_Radio}\nsqrt(mean((conj_teste$Vendas - predict(mod2, conj_teste)) ^ 2)) \n```\n\n## Análise de Resíduos\n\n```{r residuos2, message=FALSE, fig.height=7}\ncheck_model(mod2)\n```\n\n\\newpage\n\n## 3o Modelo de Regressão\n\n```{r 3omodelo-regressao, fig.height= 5}\nmod3 <- lm( Vendas ~ Jornal, data = conj_treino)\ncoeflinear <- mod3$coefficients[1]\ncoefang <- mod3$coefficients[2]\nsummary(mod3)\nggplot(propaganda, aes(x=Jornal, y=Vendas)) +\n    geom_point() +\n    geom_abline(slope = coefang,intercept = coeflinear, color=\"blue\" ) + \n    geom_hline(yintercept=coeflinear, linetype=\"dashed\", color = \"red\")\n```\n\n## Outra forma de representação do 3o Modelo\n\n```{r 3areg, message=FALSE}\nscatterplot(Vendas ~ Jornal, data = conj_treino, smooth=F, id.n=1)\n```\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r avaliando_mod3}\nsqrt(mean((conj_teste$Vendas - predict(mod3, conj_teste)) ^ 2)) \n```\n\n## Análise de Resíduos\n\n```{r residuos3, message=FALSE, fig.height=7}\ncheck_model(mod3)\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":{"html_document":{"toc":"yes","code_download":"yes"}},"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"Aula07.1.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.37","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"Regressão Linear","author":"Ricardo Accioly","date":"`r Sys.Date()`"},"extensions":{"book":{"multiFile":true}}}}}