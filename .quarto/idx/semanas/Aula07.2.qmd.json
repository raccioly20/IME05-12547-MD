{"title":"Regressão Linear Múltipla","markdown":{"yaml":{"title":"Regressão Linear Múltipla","author":"Ricardo Accioly","date":"`r Sys.Date()`","format":{"html":{"grid":{"margin-width":"350px"},"code-link":true}},"reference-location":"margin","citation-location":"margin"},"headingText":"Carregando bibliotecas","containsRefs":false,"markdown":"\n\n\n```{r}\nlibrary(tidyverse)\n```\n\n## Dados de propaganda\n\nO conjunto de dados contém estatísticas sobre as vendas de um produto em 200 diferentes mercados, juntamente com orçamentos publicitários em cada um desses mercados, para diferentes canais de mídia: TV, rádio e jornal. As vendas estão em milhares de unidades e o orçamento está em milhares de dólares.\n\n```{r}\nlibrary(readxl)\npropaganda <- read_excel(\"Propaganda.xlsx\")\nsummary(propaganda)\n```\n\n## Renomeando\n\n```{r}\npropaganda <- propaganda %>% rename(Jornal = Newspaper, Vendas = Sales)\n\n```\n\n## Sumario\n\n```{r}\nsummary(propaganda)\nnrow(propaganda)\n```\n\n## Linhas inicias\n\n```{r}\nlibrary(gt)\ngt(head(propaganda, 10))  %>% \n  tab_header(title = \"Propaganda\")\n```\n\n## Criando amostra de treino e teste\n\n```{r}\nlibrary(caret)\nset.seed(21)\ny <- propaganda$Vendas\nindice_teste <- createDataPartition(y, times = 1, p = 0.40, list = FALSE)\n\nconj_treino <- propaganda[-indice_teste, ]\nconj_teste <- propaganda[indice_teste, ]\n\nstr(conj_treino)\nstr(conj_teste)\n\nlibrary(skimr)\nconj_treino %>% skim()\nconj_teste %>% skim()\n```\n\n## E se eu usar uma outra semente?\n\n```{r}\nset.seed(23)\ny2 <- propaganda$Vendas\nindice_teste2 <- createDataPartition(y2, times = 1, p = 0.40, list = FALSE)\n\nconj_treino2 <- propaganda[-indice_teste2, ]\nconj_teste2 <- propaganda[indice_teste2, ]\n\nconj_treino2 %>% skim()\nconj_teste2 %>% skim()\n```\n\nVeja que as amostram ficaram com resultados diferentes, o que levaria a obtermos modelos diferentes num ajuste de regressão!\n\n## Regressão Simples\n\n```{r}\nmod1 <- lm( Vendas ~ TV, data = conj_treino)\nmod2 <- lm( Vendas ~ Radio, data = conj_treino)\nmod3 <- lm( Vendas ~ Jornal, data = conj_treino)\n```\n\n## 1a Regressão Multipla\n\n```{r}\nlibrary(car)\nscatterplotMatrix(conj_treino)\nmod4 <- lm( Vendas ~ TV + Radio + Jornal, data = conj_treino)\nsummary(mod4)\n```\n\nVejam que ao analisarmos a estatística t de Jornal percebemos que não podemos rejeitar a hipótese de que o coeficiente de Jornal possa ser zero.\n\nVamos refazer o modleo sem Jornal.\n\n## 2a Regressao Multipla\n\n```{r}\nmod5 <- lm( Vendas ~ TV + Radio, data = conj_treino)\nsummary(mod5)\n\n```\n\nAgora todas as variáveis tem indicação de significância estatística.\n\n## Confirmando o teste t com o teste F (ANOVA)\n\n```{r}\nanova(mod5, mod4)\n```\n\n## Vamos comparar com o modelo só com TV\n\n```{r}\nanova(mod1, mod5)\n```\n\nVeja que agora a diferença é significativa. O melhor modelo é o com TV e Radio (mod5)\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r}\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2)) \n```\n\n## Comparando com a melhor regressão simples\n\n```{r}\n## Modelo com somente TV\nsummary(mod1)$sigma\nsummary(mod1)$r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod1, conj_teste)) ^ 2))\n## Modelo com TV e Jornal\nsummary(mod5)$sigma\nsummary(mod5)$adj.r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2))\n```\n\n## Comparando valor real vs ajustado\n\n```{r}\nconj_treino$Previsoes <- predict(mod5, data=conj_treino)\nggplot(conj_treino, aes(x=Previsoes, y=Vendas)) + \n  geom_point() +\n  geom_abline(color = \"darkblue\") +\n  ggtitle(\"Vendas vs. Previsões do modelo linear\")\n```\n\n## Análise Inicial dos Resíduos\n\n```{r}\nplot(mod5)\n```\n\n## Análise do Modelo - Parte 2\n\nO pacote easystats tem uma função que faz uma análise mais detalhada do modelo. Os gráficos são mais fáceis de interpretar do que os obtidos com o plot do R base.\n\n```{r}\n#| label: fig-fullwidth\n#| fig-cap: \"A full width figure.\"\n#| fig-width: 11\n#| fig-height: 10\n#| fig-column: page-right\n#| warning: false\nlibrary(easystats)\ncheck_model(mod5)\n```\n\n## Análise do Modelo - Parte 3\n\nO pacote car apresenta funções mais avançadas para análise de resíduos.\n\nPara o gráfico de resíduos versus valores ajustados, podemos usar um teste chamado teste de Tukey de não aditividade (Tukey, 1949), ele é obtido adicionando os quadrados dos valores ajustados ao modelo e reajustando. O valor p para o teste de Tukey é obtido comparando a estatística de teste para a distribuição padrão-normal. O teste confirma a visível impressão de curvatura no gráfico residual, reforçando ainda mais a conclusão que o modelo não é adequado.\n\n```{r}\nlibrary(car)\nresidualPlots(mod5)\ninfluencePlot(mod5)\n```\n\n## Tentando avaliar transformações\n\nAqui vamos avaliar a necessidade de transformar as variáveis para melhorar o modelo.\n\n```{r}\n\nsummary(p1 <- powerTransform(Vendas ~ TV + Radio, data=conj_treino))\nsummary(p2 <- powerTransform(cbind(TV, Radio) ~1 , data=conj_treino))\nboxCox(mod5, lambda = seq(-2, 2, 1/10))\n\n```\n\n## Análise do Modelo com car\n\n```{r}\n# Fator de inflação da variância\nvif(mod5)\n```\n\n# Teste dos resíduos\n\nTeste de normalidade Teste de heterocedasticidade (Bresch-Pagan) Teste de autocorrelação (Durbin-Watson)\n\n```{r}\nlibrary(lmtest)\nmod5_sum <- summary(mod5)\n# Teste de normalidade\nshapiro.test(mod5_sum$residuals)\n# Teste de heterocedasticidade\nbptest(mod5)\n#Teste de autocorrelação\ndwtest(mod5)\n```\n\n## Dado que parece outlier e é um valor influente\n\nA função OutlierTest () no pacote do car localiza o maior resíduo studentizado em valor absoluto e calcula o teste t com correção de Bonferroni. O testes de Outlier utiliza uma distribuição t para testar se o maior valor do residuo studentizado do modelo é estatisticamente diferente das outras observações. Um valor p significativo indica um outlier extremo que merece um exame mais aprofundado.\n\n```{r}\noutlierTest(mod5)\nconj_treino[83,]\n```\n","srcMarkdownNoYaml":"\n\n## Carregando bibliotecas\n\n```{r}\nlibrary(tidyverse)\n```\n\n## Dados de propaganda\n\nO conjunto de dados contém estatísticas sobre as vendas de um produto em 200 diferentes mercados, juntamente com orçamentos publicitários em cada um desses mercados, para diferentes canais de mídia: TV, rádio e jornal. As vendas estão em milhares de unidades e o orçamento está em milhares de dólares.\n\n```{r}\nlibrary(readxl)\npropaganda <- read_excel(\"Propaganda.xlsx\")\nsummary(propaganda)\n```\n\n## Renomeando\n\n```{r}\npropaganda <- propaganda %>% rename(Jornal = Newspaper, Vendas = Sales)\n\n```\n\n## Sumario\n\n```{r}\nsummary(propaganda)\nnrow(propaganda)\n```\n\n## Linhas inicias\n\n```{r}\nlibrary(gt)\ngt(head(propaganda, 10))  %>% \n  tab_header(title = \"Propaganda\")\n```\n\n## Criando amostra de treino e teste\n\n```{r}\nlibrary(caret)\nset.seed(21)\ny <- propaganda$Vendas\nindice_teste <- createDataPartition(y, times = 1, p = 0.40, list = FALSE)\n\nconj_treino <- propaganda[-indice_teste, ]\nconj_teste <- propaganda[indice_teste, ]\n\nstr(conj_treino)\nstr(conj_teste)\n\nlibrary(skimr)\nconj_treino %>% skim()\nconj_teste %>% skim()\n```\n\n## E se eu usar uma outra semente?\n\n```{r}\nset.seed(23)\ny2 <- propaganda$Vendas\nindice_teste2 <- createDataPartition(y2, times = 1, p = 0.40, list = FALSE)\n\nconj_treino2 <- propaganda[-indice_teste2, ]\nconj_teste2 <- propaganda[indice_teste2, ]\n\nconj_treino2 %>% skim()\nconj_teste2 %>% skim()\n```\n\nVeja que as amostram ficaram com resultados diferentes, o que levaria a obtermos modelos diferentes num ajuste de regressão!\n\n## Regressão Simples\n\n```{r}\nmod1 <- lm( Vendas ~ TV, data = conj_treino)\nmod2 <- lm( Vendas ~ Radio, data = conj_treino)\nmod3 <- lm( Vendas ~ Jornal, data = conj_treino)\n```\n\n## 1a Regressão Multipla\n\n```{r}\nlibrary(car)\nscatterplotMatrix(conj_treino)\nmod4 <- lm( Vendas ~ TV + Radio + Jornal, data = conj_treino)\nsummary(mod4)\n```\n\nVejam que ao analisarmos a estatística t de Jornal percebemos que não podemos rejeitar a hipótese de que o coeficiente de Jornal possa ser zero.\n\nVamos refazer o modleo sem Jornal.\n\n## 2a Regressao Multipla\n\n```{r}\nmod5 <- lm( Vendas ~ TV + Radio, data = conj_treino)\nsummary(mod5)\n\n```\n\nAgora todas as variáveis tem indicação de significância estatística.\n\n## Confirmando o teste t com o teste F (ANOVA)\n\n```{r}\nanova(mod5, mod4)\n```\n\n## Vamos comparar com o modelo só com TV\n\n```{r}\nanova(mod1, mod5)\n```\n\nVeja que agora a diferença é significativa. O melhor modelo é o com TV e Radio (mod5)\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r}\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2)) \n```\n\n## Comparando com a melhor regressão simples\n\n```{r}\n## Modelo com somente TV\nsummary(mod1)$sigma\nsummary(mod1)$r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod1, conj_teste)) ^ 2))\n## Modelo com TV e Jornal\nsummary(mod5)$sigma\nsummary(mod5)$adj.r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2))\n```\n\n## Comparando valor real vs ajustado\n\n```{r}\nconj_treino$Previsoes <- predict(mod5, data=conj_treino)\nggplot(conj_treino, aes(x=Previsoes, y=Vendas)) + \n  geom_point() +\n  geom_abline(color = \"darkblue\") +\n  ggtitle(\"Vendas vs. Previsões do modelo linear\")\n```\n\n## Análise Inicial dos Resíduos\n\n```{r}\nplot(mod5)\n```\n\n## Análise do Modelo - Parte 2\n\nO pacote easystats tem uma função que faz uma análise mais detalhada do modelo. Os gráficos são mais fáceis de interpretar do que os obtidos com o plot do R base.\n\n```{r}\n#| label: fig-fullwidth\n#| fig-cap: \"A full width figure.\"\n#| fig-width: 11\n#| fig-height: 10\n#| fig-column: page-right\n#| warning: false\nlibrary(easystats)\ncheck_model(mod5)\n```\n\n## Análise do Modelo - Parte 3\n\nO pacote car apresenta funções mais avançadas para análise de resíduos.\n\nPara o gráfico de resíduos versus valores ajustados, podemos usar um teste chamado teste de Tukey de não aditividade (Tukey, 1949), ele é obtido adicionando os quadrados dos valores ajustados ao modelo e reajustando. O valor p para o teste de Tukey é obtido comparando a estatística de teste para a distribuição padrão-normal. O teste confirma a visível impressão de curvatura no gráfico residual, reforçando ainda mais a conclusão que o modelo não é adequado.\n\n```{r}\nlibrary(car)\nresidualPlots(mod5)\ninfluencePlot(mod5)\n```\n\n## Tentando avaliar transformações\n\nAqui vamos avaliar a necessidade de transformar as variáveis para melhorar o modelo.\n\n```{r}\n\nsummary(p1 <- powerTransform(Vendas ~ TV + Radio, data=conj_treino))\nsummary(p2 <- powerTransform(cbind(TV, Radio) ~1 , data=conj_treino))\nboxCox(mod5, lambda = seq(-2, 2, 1/10))\n\n```\n\n## Análise do Modelo com car\n\n```{r}\n# Fator de inflação da variância\nvif(mod5)\n```\n\n# Teste dos resíduos\n\nTeste de normalidade Teste de heterocedasticidade (Bresch-Pagan) Teste de autocorrelação (Durbin-Watson)\n\n```{r}\nlibrary(lmtest)\nmod5_sum <- summary(mod5)\n# Teste de normalidade\nshapiro.test(mod5_sum$residuals)\n# Teste de heterocedasticidade\nbptest(mod5)\n#Teste de autocorrelação\ndwtest(mod5)\n```\n\n## Dado que parece outlier e é um valor influente\n\nA função OutlierTest () no pacote do car localiza o maior resíduo studentizado em valor absoluto e calcula o teste t com correção de Bonferroni. O testes de Outlier utiliza uma distribuição t para testar se o maior valor do residuo studentizado do modelo é estatisticamente diferente das outras observações. Um valor p significativo indica um outlier extremo que merece um exame mais aprofundado.\n\n```{r}\noutlierTest(mod5)\nconj_treino[83,]\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":true,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"reference-location":"margin","output-file":"Aula07.2.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"Regressão Linear Múltipla","author":"Ricardo Accioly","date":"`r Sys.Date()`","citation-location":"margin","grid":{"margin-width":"350px"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}