{"title":"Regressão Linear Múltipla","markdown":{"yaml":{"title":"Regressão Linear Múltipla","author":"Ricardo Accioly","date":"`r Sys.Date()`","output":{"html_document":{"toc":"yes","code_download":"yes"}}},"headingText":"Carregando bibliotecas","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(fig.width = 10, \n                      fig.height= 8,  \n                      fig.retina = 3,\n                      message = FALSE, \n                      warning = FALSE,\n                      dev=c(\"png\"), \n                      fig.path=\"imagens/Aula07_2/\")\n```\n\n\n```{r}\nlibrary(tidyverse)\n```\n\n## Dados de propaganda\n\nO conjunto de dados contém estatísticas sobre as vendas de um produto em 200 diferentes mercados, juntamente com orçamentos publicitários em cada um desses mercados, para diferentes canais de mídia: TV, rádio e jornal. As vendas estão em milhares de unidades e o orçamento está em milhares de dólares.\n\n```{r carrega-dados}\nlibrary(readxl)\npropaganda <- read_excel(\"Propaganda.xlsx\")\nsummary(propaganda)\n```\n\n## Renomeando\n\n```{r renomeando}\npropaganda <- propaganda %>% rename(Jornal = Newspaper, Vendas = Sales)\n\n```\n\n## Sumario\n\n```{r sumario}\nsummary(propaganda)\nnrow(propaganda)\n```\n\n## Linhas inicias\n\n```{r head}\nlibrary(gt)\ngt(head(propaganda, 10))\n```\n\n## Criando amostra de treino e teste\n\n```{r treino_teste, message=FALSE}\nlibrary(caret)\nset.seed(21)\ny <- propaganda$Vendas\nindice_teste <- createDataPartition(y, times = 1, p = 0.40, list = FALSE)\n\nconj_treino <- propaganda %>% slice(-indice_teste)\nconj_teste <- propaganda %>% slice(indice_teste)\n\nstr(conj_treino)\nstr(conj_teste)\ngt(head(conj_treino, 10))\n```\n\n\\newpage\n\n## Regressão Simples\n\n```{r 1a_regressão, message=FALSE}\nmod1 <- lm( Vendas ~ TV, data = conj_treino)\nmod2 <- lm( Vendas ~ Radio, data = conj_treino)\nmod3 <- lm( Vendas ~ Jornal, data = conj_treino)\n```\n\n\\newpage\n\n## 1a Regressão Multipla\n\n```{r regressao-multipla}\nlibrary(car)\nscatterplotMatrix(conj_treino)\nmod4 <- lm( Vendas ~ TV + Radio + Jornal, data = conj_treino)\nsummary(mod4)\n```\n\n## 2a Regressao Multipla\n\n```{r regmult-sem-jornal}\nmod5 <- lm( Vendas ~ TV + Radio, data = conj_treino)\nsummary(mod5)\n\n```\n\n## Confirmando o teste t com o teste F (ANOVA)\n\n```{r}\nanova(mod5, mod4)\n```\n\n## Calculando o erro padrão do resíduo com amostra de teste\n\n```{r avaliando_mod5}\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2)) \n```\n\n## Comparando com a melhor regressão simples\n\n```{r simples_multipla}\n## Modelo com somente TV\nsummary(mod1)$sigma\nsummary(mod1)$r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod1, conj_teste)) ^ 2))\n## Modelo com TV e Jornal\nsummary(mod5)$sigma\nsummary(mod5)$adj.r.squared\nsqrt(mean((conj_teste$Vendas - predict(mod5, conj_teste)) ^ 2))\n```\n\n## Análise do Modelo 1\n\n```{r residuos, message=FALSE}\nlibrary(performance)\ncheck_model(mod5)\n```\n\n## Análise do Modelo 2\n\n```{r residuos2, message=FALSE}\nplot(mod5)\n```\n\n## Análise do Modelo 3\n\nPara o gráfico de resíduos versus valores ajustados, podemos usar um teste chamado teste de Tukey de não aditividade (Tukey, 1949), ele é obtido adicionando os quadrados dos valores ajustados ao modelo e reajustando. O valor p para o teste de Tukey é obtido comparando a estatística de teste para a distribuição padrão-normal. O teste confirma a visível impressão de curvatura no gráfico residual, reforçando ainda mais a conclusão que o modelo não é adequado.\n\n```{r residuos3, message=FALSE}\nlibrary(car)\nresidualPlots(mod5)\n```\n\n## Análise do Modelo com car\n\n```{r car1, message=FALSE}\nlibrary(car)\nvif(mod5)\n```\n\n## Tentando corrigir o problema\n\n```{r transf_resposta}\nsummary(p1 <- powerTransform(Vendas ~ TV + Radio, data=conj_treino))\nsummary(p2 <- powerTransform(cbind(TV, Radio) ~1 , data=conj_treino))\nmod6 <- lm( log(Vendas) ~ TV + Radio, data = conj_treino)\nsummary(mod6)\nresidualPlots(mod6)\n```\n\n## Dado que parece outlier e é um valor influente\n\nA função OutlierTest () no pacote do car localiza o maior resíduo studentizado em valor absoluto e calcula o teste t com correção de Bonferroni. O testes de Outlier utiliza uma distribuição t para testar se o maior valor do residuo studentizado do modelo é estatisticamente diferente das outras observações. Um valor p significativo indica um outlier extremo que merece um exame mais aprofundado.\n\n```{r}\noutlierTest(mod6)\nconj_treino[83,]\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":{"html_document":{"toc":"yes","code_download":"yes"}},"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"Aula07.2.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.37","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"Regressão Linear Múltipla","author":"Ricardo Accioly","date":"`r Sys.Date()`"},"extensions":{"book":{"multiFile":true}}}}}