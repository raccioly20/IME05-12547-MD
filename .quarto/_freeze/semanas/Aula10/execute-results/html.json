{
  "hash": "b10ff166b1196c788b8c674cf93173e7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"LDA e QDA\"\nauthor: \"Ricardo Accioly\"\ndate: \"2025-10-28\"\nformat:\n html:\n    code-link: true\n    fig-height: 8\n    fig-width: 12\n    fig-align: center\nknitr: \n   opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\nexecute: \n  echo: true\n  warning: false\n  message: false\n  freeze: auto\n---\n\n## LDA e QDA\n\n## Carregando Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(caret)\nlibrary(patchwork)\nlibrary(pROC)\nlibrary(ISLR)\ndata(Default)\nsummary(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  default    student       balance           income     \n#>  No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n#>  Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n#>                        Median : 823.6   Median :34553  \n#>                        Mean   : 835.4   Mean   :33517  \n#>                        3rd Qu.:1166.3   3rd Qu.:43808  \n#>                        Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> 'data.frame':\t10000 obs. of  4 variables:\n#>  $ default: Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ student: Factor w/ 2 levels \"No\",\"Yes\": 1 2 1 1 1 2 1 2 1 1 ...\n#>  $ balance: num  730 817 1074 529 786 ...\n#>  $ income : num  44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>   default student   balance    income\n#> 1      No      No  729.5265 44361.625\n#> 2      No     Yes  817.1804 12106.135\n#> 3      No      No 1073.5492 31767.139\n#> 4      No      No  529.2506 35704.494\n#> 5      No      No  785.6559 38463.496\n#> 6      No     Yes  919.5885  7491.559\n```\n\n\n:::\n:::\n\n\n## Manipulando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncredito <- tibble(Default)\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  default    student       balance           income     \n#>  No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n#>  Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n#>                        Median : 823.6   Median :34553  \n#>                        Mean   : 835.4   Mean   :33517  \n#>                        3rd Qu.:1166.3   3rd Qu.:43808  \n#>                        Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\n# renomeando colunas\ncredito <- credito %>% \n                rename( inadimplente = default, estudante = student, balanco = balance,\n                receita = income)\ncredito <- credito %>% mutate( inadimplente =  case_when(\n                           inadimplente == \"No\"  ~ \"Nao\",\n                           inadimplente == \"Yes\" ~ \"Sim\"\n                          )) %>% mutate(inadimplente = factor(inadimplente))\ncredito <- credito %>% mutate( estudante =  case_when(\n                           estudante == \"No\"  ~ 0,\n                           estudante == \"Yes\" ~ 1\n                          )) \n\nstr(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> tibble [10,000 × 4] (S3: tbl_df/tbl/data.frame)\n#>  $ inadimplente: Factor w/ 2 levels \"Nao\",\"Sim\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ estudante   : num [1:10000] 0 1 0 0 0 1 0 1 0 0 ...\n#>  $ balanco     : num [1:10000] 730 817 1074 529 786 ...\n#>  $ receita     : num [1:10000] 44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:9667     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n#>  Sim: 333     1st Qu.:0.0000   1st Qu.: 481.7   1st Qu.:21340  \n#>               Median :0.0000   Median : 823.6   Median :34553  \n#>               Mean   :0.2944   Mean   : 835.4   Mean   :33517  \n#>               3rd Qu.:1.0000   3rd Qu.:1166.3   3rd Qu.:43808  \n#>               Max.   :1.0000   Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n:::\n\n\n## Treino e Teste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\ny <- credito$inadimplente\nindice_teste <- createDataPartition(y, times = 1, p = 0.1, list = FALSE)\n\nconj_treino <- credito[-indice_teste,]\nconj_teste <- credito[indice_teste,]\n\nsummary(conj_treino)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:8700     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n#>  Sim: 299     1st Qu.:0.0000   1st Qu.: 483.6   1st Qu.:21343  \n#>               Median :0.0000   Median : 821.3   Median :34576  \n#>               Mean   :0.2946   Mean   : 836.3   Mean   :33556  \n#>               3rd Qu.:1.0000   3rd Qu.:1167.1   3rd Qu.:43854  \n#>               Max.   :1.0000   Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_teste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:967      Min.   :0.0000   Min.   :   0.0   Min.   : 5386  \n#>  Sim: 34      1st Qu.:0.0000   1st Qu.: 453.6   1st Qu.:21319  \n#>               Median :0.0000   Median : 839.9   Median :34086  \n#>               Mean   :0.2927   Mean   : 827.4   Mean   :33170  \n#>               3rd Qu.:1.0000   3rd Qu.:1156.3   3rd Qu.:42856  \n#>               Max.   :1.0000   Max.   :2221.0   Max.   :70701\n```\n\n\n:::\n:::\n\n\n## Balanço e receita\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfeaturePlot(x = conj_treino[, c(\"balanco\", \"receita\", \"estudante\")], \n            y = conj_treino$inadimplente,\n            plot = \"density\", \n            scales = list(x = list(relation = \"free\"), \n                          y = list(relation = \"free\")), \n            adjust = 1.5, \n            pch = \"|\", \n            layout = c(2, 1), \n            auto.key = list(columns = 2))\n```\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/unnamed-chunk-4-1.png){width=90%}\n:::\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/unnamed-chunk-4-2.png){width=90%}\n:::\n:::\n\n\n## Avaliando o comportamento das variáveis em função do status (inadimplente / estudante)\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(credito, aes(x=inadimplente, y=balanco, color=inadimplente)) +\n  geom_boxplot()\np2 <- ggplot(credito, aes(x=inadimplente, y=receita, color=inadimplente)) +\n  geom_boxplot()\np3 <- ggplot(credito, aes(x=as.factor(estudante), y=balanco, color=as.factor(estudante))) +\n  geom_boxplot()\np4 <- ggplot(credito, aes(x=as.factor(estudante), y=receita, color=as.factor(estudante))) +\n  geom_boxplot()\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/unnamed-chunk-5-1.png){width=90%}\n:::\n:::\n\n\n## Calcula Erro\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Este valor é igual a 1 - Accuracy da matriz de confusão\ncalc_erro_class <- function(real, previsto) {\n  mean(real != previsto)\n}\n```\n:::\n\n\n## Treino e Teste Normalizado\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\n# Normalizando os dados\ncredito <- credito %>% mutate(balanco = scale(balanco), receita = scale(receita))\n\ny <- credito$inadimplente\nindice_teste <- createDataPartition(y, times = 1, p = 0.1, list = FALSE)\n\nconj_treino <- credito[-indice_teste,]\nconj_teste <- credito[indice_teste,]\n\nsummary(conj_treino)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante              balanco.V1        \n#>  Nao:8700     Min.   :0.0000   Min.   :-1.7269981521400  \n#>  Sim: 299     1st Qu.:0.0000   1st Qu.:-0.7272060665610  \n#>               Median :0.0000   Median :-0.0291998518895  \n#>               Mean   :0.2946   Mean   : 0.0018226420526  \n#>               3rd Qu.:1.0000   3rd Qu.: 0.6857204109320  \n#>               Max.   :1.0000   Max.   : 3.7603707685300  \n#>          receita.V1         \n#>  Min.   :-2.45526723525000  \n#>  1st Qu.:-0.91285296803300  \n#>  Median : 0.07944356241920  \n#>  Mean   : 0.00289685391251  \n#>  3rd Qu.: 0.77511346775700  \n#>  Max.   : 3.00204946164000\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_teste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante              balanco.V1        \n#>  Nao:967      Min.   :0.0000   Min.   :-1.7269981521400  \n#>  Sim: 34      1st Qu.:0.0000   1st Qu.:-0.7891649577870  \n#>               Median :0.0000   Median : 0.0093006623621  \n#>               Mean   :0.2927   Mean   :-0.0163855702611  \n#>               3rd Qu.:1.0000   3rd Qu.: 0.6634375247520  \n#>               Max.   :1.0000   Max.   : 2.8644787899700  \n#>          receita.V1        \n#>  Min.   :-2.1092873704200  \n#>  1st Qu.:-0.9146153990120  \n#>  Median : 0.0426948006874  \n#>  Mean   :-0.0260427456131  \n#>  3rd Qu.: 0.7002669659310  \n#>  Max.   : 2.7880835940500\n```\n\n\n:::\n:::\n\n\n## LDA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\n\ntreina_lda <- lda(inadimplente ~ balanco + estudante + receita, data = conj_treino)\ntreina_lda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Call:\n#> lda(inadimplente ~ balanco + estudante + receita, data = conj_treino)\n#> \n#> Prior probabilities of groups:\n#>        Nao        Sim \n#> 0.96677409 0.03322591 \n#> \n#> Group means:\n#>        balanco estudante      receita\n#> Nao -0.0634482 0.2911494  0.007360464\n#> Sim  1.9010077 0.3946488 -0.126980756\n#> \n#> Coefficients of linear discriminants:\n#>                   LD1\n#> balanco    1.08544320\n#> estudante -0.13706793\n#> receita    0.04896283\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(treina_lda)\n```\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/LDA-1.png){width=90%}\n:::\n\n```{.r .cell-code}\nnames(predict(treina_lda, conj_treino))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] \"class\"     \"posterior\" \"x\"\n```\n\n\n:::\n\n```{.r .cell-code}\ny_chapeu <- predict(treina_lda, conj_teste)$class %>% \n             factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(data = y_chapeu, reference = conj_teste$inadimplente,  positive=\"Sim\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 963  26\n#>        Sim   4   8\n#>                                           \n#>                Accuracy : 0.97            \n#>                  95% CI : (0.9575, 0.9797)\n#>     No Information Rate : 0.966           \n#>     P-Value [Acc > NIR] : 0.276410        \n#>                                           \n#>                   Kappa : 0.3361          \n#>                                           \n#>  Mcnemar's Test P-Value : 0.000126        \n#>                                           \n#>             Sensitivity : 0.235294        \n#>             Specificity : 0.995863        \n#>          Pos Pred Value : 0.666667        \n#>          Neg Pred Value : 0.973711        \n#>              Prevalence : 0.033966        \n#>          Detection Rate : 0.007992        \n#>    Detection Prevalence : 0.011988        \n#>       Balanced Accuracy : 0.615579        \n#>                                           \n#>        'Positive' Class : Sim             \n#> \n```\n\n\n:::\n\n```{.r .cell-code}\n# Este valor é igual a 1 - Accuracy da matriz de confusão\ncalc_erro_class(conj_teste$inadimplente, y_chapeu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.02997003\n```\n\n\n:::\n:::\n\n\n## LDA - Ajustando probabilidade limite\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_chapeu <- predict(treina_lda, conj_teste)$posterior\nhead(p_chapeu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>         Nao          Sim\n#> 1 0.9884029 0.0115970705\n#> 2 0.9991276 0.0008724065\n#> 3 0.9961405 0.0038594545\n#> 4 0.9917937 0.0082062901\n#> 5 0.9872043 0.0127956737\n#> 6 0.9981856 0.0018144078\n```\n\n\n:::\n\n```{.r .cell-code}\ny_chapeu <- ifelse(p_chapeu[, 2] > 0.11, \"Sim\", \"Nao\") %>% \n             factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(data = y_chapeu, reference = conj_teste$inadimplente,  positive=\"Sim\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 913  11\n#>        Sim  54  23\n#>                                          \n#>                Accuracy : 0.9351         \n#>                  95% CI : (0.918, 0.9495)\n#>     No Information Rate : 0.966          \n#>     P-Value [Acc > NIR] : 1              \n#>                                          \n#>                   Kappa : 0.3855         \n#>                                          \n#>  Mcnemar's Test P-Value : 1.894e-07      \n#>                                          \n#>             Sensitivity : 0.67647        \n#>             Specificity : 0.94416        \n#>          Pos Pred Value : 0.29870        \n#>          Neg Pred Value : 0.98810        \n#>              Prevalence : 0.03397        \n#>          Detection Rate : 0.02298        \n#>    Detection Prevalence : 0.07692        \n#>       Balanced Accuracy : 0.81031        \n#>                                          \n#>        'Positive' Class : Sim            \n#> \n```\n\n\n:::\n\n```{.r .cell-code}\n# Este valor é igual a 1 - Accuracy da matriz de confusão\ncalc_erro_class(conj_teste$inadimplente, y_chapeu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.06493506\n```\n\n\n:::\n:::\n\n\n## Seleção de variáveis\n\nNo LDA, a seleção de variáveis pode ser feita com o RFE (Recursive Feature Elimination). O RFE é um método de seleção de variáveis que utiliza a validação cruzada para avaliar o desempenho do modelo com diferentes subconjuntos de variáveis. O RFE é implementado na função `rfe()` do pacote `caret`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Usar o RFE para selecionar as variáveis\n# Definir controle para RFE\ncontrol <- rfeControl(functions = ldaFuncs, method = \"cv\", number = 10)\n\n# Aplicar o RFE\nset.seed(2025)\nresult <- rfe(conj_treino[, 2:4], conj_treino$inadimplente, sizes = c(1:3), rfeControl = control)\n\n# Resultados\nprint(result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> \n#> Recursive feature selection\n#> \n#> Outer resampling method: Cross-Validated (10 fold) \n#> \n#> Resampling performance over subset size:\n#> \n#>  Variables Accuracy  Kappa AccuracySD KappaSD Selected\n#>          1   0.9726 0.3487   0.002776  0.1048         \n#>          2   0.9728 0.3564   0.002634  0.1045        *\n#>          3   0.9724 0.3396   0.002910  0.1153         \n#> \n#> The top 2 variables (out of 2):\n#>    balanco, estudante\n```\n\n\n:::\n:::\n\n\n## Outra Opção\n\nPodemos usar os gráfico exploratórios iniciais e também o resultado da regressão logística como ponto de partida para a seleção de variáveis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntreina_lda2 <- lda(inadimplente ~ balanco + estudante, data = conj_treino)\ntreina_lda2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Call:\n#> lda(inadimplente ~ balanco + estudante, data = conj_treino)\n#> \n#> Prior probabilities of groups:\n#>        Nao        Sim \n#> 0.96677409 0.03322591 \n#> \n#> Group means:\n#>        balanco estudante\n#> Nao -0.0634482 0.2911494\n#> Sim  1.9010077 0.3946488\n#> \n#> Coefficients of linear discriminants:\n#>                  LD1\n#> balanco    1.0858203\n#> estudante -0.2183485\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(treina_lda2)\n```\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/unnamed-chunk-9-1.png){width=90%}\n:::\n\n```{.r .cell-code}\ny_chapeu <- predict(treina_lda2, conj_teste)$class %>% \n             factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(data = y_chapeu, reference = conj_teste$inadimplente,  positive=\"Sim\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 963  26\n#>        Sim   4   8\n#>                                           \n#>                Accuracy : 0.97            \n#>                  95% CI : (0.9575, 0.9797)\n#>     No Information Rate : 0.966           \n#>     P-Value [Acc > NIR] : 0.276410        \n#>                                           \n#>                   Kappa : 0.3361          \n#>                                           \n#>  Mcnemar's Test P-Value : 0.000126        \n#>                                           \n#>             Sensitivity : 0.235294        \n#>             Specificity : 0.995863        \n#>          Pos Pred Value : 0.666667        \n#>          Neg Pred Value : 0.973711        \n#>              Prevalence : 0.033966        \n#>          Detection Rate : 0.007992        \n#>    Detection Prevalence : 0.011988        \n#>       Balanced Accuracy : 0.615579        \n#>                                           \n#>        'Positive' Class : Sim             \n#> \n```\n\n\n:::\n\n```{.r .cell-code}\n# Este valor é igual a 1 - Accuracy da matriz de confusão\ncalc_erro_class(conj_teste$inadimplente, y_chapeu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.02997003\n```\n\n\n:::\n:::\n\n\nPodemos observar que não houve mudança nos resultados ao retirar a variável receita.\n\n## QDA\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntreina_qda <- qda(inadimplente ~ balanco + estudante + receita, data = conj_treino)\ntreina_qda\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Call:\n#> qda(inadimplente ~ balanco + estudante + receita, data = conj_treino)\n#> \n#> Prior probabilities of groups:\n#>        Nao        Sim \n#> 0.96677409 0.03322591 \n#> \n#> Group means:\n#>        balanco estudante      receita\n#> Nao -0.0634482 0.2911494  0.007360464\n#> Sim  1.9010077 0.3946488 -0.126980756\n```\n\n\n:::\n\n```{.r .cell-code}\ny_chapeu <- predict(treina_qda, conj_teste)$class %>% \n             factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(data = y_chapeu, reference = conj_teste$inadimplente,  positive=\"Sim\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 961  25\n#>        Sim   6   9\n#>                                           \n#>                Accuracy : 0.969           \n#>                  95% CI : (0.9563, 0.9789)\n#>     No Information Rate : 0.966           \n#>     P-Value [Acc > NIR] : 0.339451        \n#>                                           \n#>                   Kappa : 0.3539          \n#>                                           \n#>  Mcnemar's Test P-Value : 0.001225        \n#>                                           \n#>             Sensitivity : 0.264706        \n#>             Specificity : 0.993795        \n#>          Pos Pred Value : 0.600000        \n#>          Neg Pred Value : 0.974645        \n#>              Prevalence : 0.033966        \n#>          Detection Rate : 0.008991        \n#>    Detection Prevalence : 0.014985        \n#>       Balanced Accuracy : 0.629251        \n#>                                           \n#>        'Positive' Class : Sim             \n#> \n```\n\n\n:::\n:::\n\n\n## QDA - Ajustando probabilidade limite\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_chapeu <- predict(treina_qda, conj_teste)$posterior\nhead(p_chapeu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>         Nao          Sim\n#> 1 0.9942055 5.794489e-03\n#> 2 0.9999644 3.560287e-05\n#> 3 0.9990581 9.419042e-04\n#> 4 0.9958847 4.115349e-03\n#> 5 0.9916023 8.397668e-03\n#> 6 0.9999253 7.471756e-05\n```\n\n\n:::\n\n```{.r .cell-code}\ny_chapeu <- ifelse(p_chapeu[, 2] > 0.11, \"Sim\", \"Nao\") %>% \n             factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(data = y_chapeu, reference = conj_teste$inadimplente,  positive=\"Sim\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 905  11\n#>        Sim  62  23\n#>                                           \n#>                Accuracy : 0.9271          \n#>                  95% CI : (0.9092, 0.9424)\n#>     No Information Rate : 0.966           \n#>     P-Value [Acc > NIR] : 1               \n#>                                           \n#>                   Kappa : 0.3553          \n#>                                           \n#>  Mcnemar's Test P-Value : 4.855e-09       \n#>                                           \n#>             Sensitivity : 0.67647         \n#>             Specificity : 0.93588         \n#>          Pos Pred Value : 0.27059         \n#>          Neg Pred Value : 0.98799         \n#>              Prevalence : 0.03397         \n#>          Detection Rate : 0.02298         \n#>    Detection Prevalence : 0.08492         \n#>       Balanced Accuracy : 0.80618         \n#>                                           \n#>        'Positive' Class : Sim             \n#> \n```\n\n\n:::\n:::\n\n\n## Curva ROC\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# KNN\nset.seed(2025)\nctrl <- trainControl(method = \"cv\")\ntreina_knn <- train(inadimplente ~ balanco + estudante, method = \"knn\", trControl= ctrl, preProcess=c(\"center\", \"scale\"), tuneGrid = data.frame(k = seq(21,140, by=4)), data = conj_treino)\nprev_knn <- predict(treina_knn, conj_teste,type = \"prob\")\n\n# Reg Log\nmod2 <- glm(inadimplente ~ balanco + estudante,data=conj_treino,family=binomial)\np_chapeu_log <- predict(mod2, newdata = conj_teste, type = \"response\")\n\n# LDA e QDA\np_chapeu_lda <- predict(treina_lda, conj_teste)$posterior\np_chapeu_qda <- predict(treina_qda, conj_teste)$posterior\n\nroc_log <- roc(conj_teste$inadimplente ~ p_chapeu_log, print.auc=FALSE)\nroc_lda <- roc(conj_teste$inadimplente ~ p_chapeu_lda[,2],  print.auc=FALSE)\nroc_qda <- roc(conj_teste$inadimplente ~ p_chapeu_qda[,2], print.auc=FALSE)\nroc_knn1 <- roc(conj_teste$inadimplente ~ prev_knn[,2], print.auc=FALSE)\n\n\n# Visualização com ggroc\nggroc(list(KNN= roc_knn1, RegLog= roc_log, LDA=roc_lda, QDA=roc_qda)) +\n  ggplot2::labs(title = \"ROC - KNN vs Reg Logística vs LDA vs QDA\", x = \"1 - Especificidade\", y = \"Sensibilidade\") +\n  ggplot2::theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Aula10_files/figure-html/ROC-1.png){width=90%}\n:::\n\n```{.r .cell-code}\nas.numeric(roc_log$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.9325385\n```\n\n\n:::\n\n```{.r .cell-code}\nas.numeric(roc_lda$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.9323256\n```\n\n\n:::\n\n```{.r .cell-code}\nas.numeric(roc_qda$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.9280978\n```\n\n\n:::\n\n```{.r .cell-code}\nas.numeric(roc_knn1$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.9109891\n```\n\n\n:::\n:::\n\n\n## Reprodutibilidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> R version 4.5.1 (2025-06-13 ucrt)\n#> Platform: x86_64-w64-mingw32/x64\n#> Running under: Windows 11 x64 (build 26200)\n#> \n#> Matrix products: default\n#>   LAPACK version 3.12.1\n#> \n#> locale:\n#> [1] LC_COLLATE=Portuguese_Brazil.utf8  LC_CTYPE=Portuguese_Brazil.utf8   \n#> [3] LC_MONETARY=Portuguese_Brazil.utf8 LC_NUMERIC=C                      \n#> [5] LC_TIME=Portuguese_Brazil.utf8    \n#> \n#> time zone: America/Sao_Paulo\n#> tzcode source: internal\n#> \n#> attached base packages:\n#> [1] stats     graphics  grDevices utils     datasets  methods   base     \n#> \n#> other attached packages:\n#>  [1] MASS_7.3-65     ISLR_1.4        pROC_1.19.0.1   patchwork_1.3.1\n#>  [5] caret_7.0-1     lattice_0.22-7  lubridate_1.9.4 forcats_1.0.0  \n#>  [9] stringr_1.5.1   dplyr_1.1.4     purrr_1.1.0     readr_2.1.5    \n#> [13] tidyr_1.3.1     tibble_3.3.0    ggplot2_3.5.2   tidyverse_2.0.0\n#> \n#> loaded via a namespace (and not attached):\n#>  [1] gtable_0.3.6         xfun_0.52            htmlwidgets_1.6.4   \n#>  [4] recipes_1.3.1        tzdb_0.5.0           vctrs_0.6.5         \n#>  [7] tools_4.5.1          generics_0.1.4       stats4_4.5.1        \n#> [10] parallel_4.5.1       proxy_0.4-27         ModelMetrics_1.2.2.2\n#> [13] pkgconfig_2.0.3      Matrix_1.7-3         data.table_1.17.8   \n#> [16] RColorBrewer_1.1-3   lifecycle_1.0.4      compiler_4.5.1      \n#> [19] farver_2.1.2         codetools_0.2-20     htmltools_0.5.8.1   \n#> [22] class_7.3-23         yaml_2.3.10          prodlim_2025.04.28  \n#> [25] pillar_1.11.0        gower_1.0.2          iterators_1.0.14    \n#> [28] rpart_4.1.24         foreach_1.5.2        nlme_3.1-168        \n#> [31] parallelly_1.45.1    lava_1.8.1           tidyselect_1.2.1    \n#> [34] digest_0.6.37        stringi_1.8.7        future_1.67.0       \n#> [37] reshape2_1.4.4       listenv_0.9.1        labeling_0.4.3      \n#> [40] splines_4.5.1        fastmap_1.2.0        grid_4.5.1          \n#> [43] cli_3.6.5            magrittr_2.0.3       dichromat_2.0-0.1   \n#> [46] survival_3.8-3       e1071_1.7-16         future.apply_1.20.0 \n#> [49] withr_3.0.2          scales_1.4.0         timechange_0.3.0    \n#> [52] rmarkdown_2.29       globals_0.18.0       nnet_7.3-20         \n#> [55] timeDate_4041.110    hms_1.1.3            evaluate_1.0.4      \n#> [58] knitr_1.50           hardhat_1.4.1        rlang_1.1.6         \n#> [61] Rcpp_1.1.0           glue_1.8.0           ipred_0.9-15        \n#> [64] rstudioapi_0.17.1    jsonlite_2.0.0       R6_2.6.1            \n#> [67] plyr_1.8.9\n```\n\n\n:::\n:::\n\n\n",
    "supporting": [
      "Aula10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}