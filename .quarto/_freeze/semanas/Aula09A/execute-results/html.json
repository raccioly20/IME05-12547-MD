{
  "hash": "1f3d877b6a382148b923a2cc5eb26ae7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Regressão Logística - SMOTE\"\nauthor: \"Ricardo Accioly\"\ndate: \"2025-10-28\"\nformat:\n html:\n    code-link: true\n    fig-height: 10\n    fig-width: 10\n    fig-align: center\n    fig-dpi: 300\nknitr: \n   opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\nexecute: \n  echo: true\n  warning: false\n  message: false\n  freeze: auto\n---\n\n## Carregando Bibliotecas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(caret)\nlibrary(ISLR)\ndata(Default)\nsummary(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  default    student       balance           income     \n#>  No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n#>  Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n#>                        Median : 823.6   Median :34553  \n#>                        Mean   : 835.4   Mean   :33517  \n#>                        3rd Qu.:1166.3   3rd Qu.:43808  \n#>                        Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> 'data.frame':\t10000 obs. of  4 variables:\n#>  $ default: Factor w/ 2 levels \"No\",\"Yes\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ student: Factor w/ 2 levels \"No\",\"Yes\": 1 2 1 1 1 2 1 2 1 1 ...\n#>  $ balance: num  730 817 1074 529 786 ...\n#>  $ income : num  44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(Default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>   default student   balance    income\n#> 1      No      No  729.5265 44361.625\n#> 2      No     Yes  817.1804 12106.135\n#> 3      No      No 1073.5492 31767.139\n#> 4      No      No  529.2506 35704.494\n#> 5      No      No  785.6559 38463.496\n#> 6      No     Yes  919.5885  7491.559\n```\n\n\n:::\n:::\n\n\n## Manipulando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncredito <- tibble(Default)\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  default    student       balance           income     \n#>  No :9667   No :7056   Min.   :   0.0   Min.   :  772  \n#>  Yes: 333   Yes:2944   1st Qu.: 481.7   1st Qu.:21340  \n#>                        Median : 823.6   Median :34553  \n#>                        Mean   : 835.4   Mean   :33517  \n#>                        3rd Qu.:1166.3   3rd Qu.:43808  \n#>                        Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\n# renomeando colunas\ncredito <- credito %>% \n                rename( inadimplente = default, estudante = student, balanco = balance,\n                receita = income)\ncredito <- credito %>% mutate( inadimplente =  case_when(\n                           inadimplente == \"No\"  ~ \"Nao\",\n                           inadimplente == \"Yes\" ~ \"Sim\"\n                          )) %>% mutate(inadimplente = factor(inadimplente))\ncredito <- credito %>% mutate( estudante =  case_when(\n                           estudante == \"No\"  ~ 0,\n                           estudante == \"Yes\" ~ 1\n                          ))\n\nstr(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> tibble [10,000 × 4] (S3: tbl_df/tbl/data.frame)\n#>  $ inadimplente: Factor w/ 2 levels \"Nao\",\"Sim\": 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ estudante   : num [1:10000] 0 1 0 0 0 1 0 1 0 0 ...\n#>  $ balanco     : num [1:10000] 730 817 1074 529 786 ...\n#>  $ receita     : num [1:10000] 44362 12106 31767 35704 38463 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(credito)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:9667     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n#>  Sim: 333     1st Qu.:0.0000   1st Qu.: 481.7   1st Qu.:21340  \n#>               Median :0.0000   Median : 823.6   Median :34553  \n#>               Mean   :0.2944   Mean   : 835.4   Mean   :33517  \n#>               3rd Qu.:1.0000   3rd Qu.:1166.3   3rd Qu.:43808  \n#>               Max.   :1.0000   Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n:::\n\n\n## Treino e Teste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\ny <- credito$inadimplente\ncredito_split <- createDataPartition(y, times = 1, p = 0.1, list = FALSE)\n\nconj_treino <- credito[-credito_split,]\nconj_teste <- credito[credito_split,]\n\nsummary(conj_treino)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:8700     Min.   :0.0000   Min.   :   0.0   Min.   :  772  \n#>  Sim: 299     1st Qu.:0.0000   1st Qu.: 483.6   1st Qu.:21343  \n#>               Median :0.0000   Median : 821.3   Median :34576  \n#>               Mean   :0.2946   Mean   : 836.3   Mean   :33556  \n#>               3rd Qu.:1.0000   3rd Qu.:1167.1   3rd Qu.:43854  \n#>               Max.   :1.0000   Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_teste)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  inadimplente   estudante         balanco          receita     \n#>  Nao:967      Min.   :0.0000   Min.   :   0.0   Min.   : 5386  \n#>  Sim: 34      1st Qu.:0.0000   1st Qu.: 453.6   1st Qu.:21319  \n#>               Median :0.0000   Median : 839.9   Median :34086  \n#>               Mean   :0.2927   Mean   : 827.4   Mean   :33170  \n#>               3rd Qu.:1.0000   3rd Qu.:1156.3   3rd Qu.:42856  \n#>               Max.   :1.0000   Max.   :2221.0   Max.   :70701\n```\n\n\n:::\n:::\n\n\n## SMOTE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(smotefamily)\nset.seed(123)\nteste <- SMOTE(conj_treino[,-1], target = conj_treino$inadimplente, K=5)\nconj_treinoS <- teste$data\nconj_treinoS$class <- as.factor(conj_treinoS$class)\nconj_treinoS <- conj_treinoS %>% rename( inadimplente = class)\nprop.table(table(conj_treinoS$inadimplente))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> \n#>       Nao       Sim \n#> 0.5008347 0.4991653\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(conj_treinoS)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>    estudante         balanco          receita      inadimplente\n#>  Min.   :0.0000   Min.   :   0.0   Min.   :  772   Nao:8700    \n#>  1st Qu.:0.0000   1st Qu.: 798.1   1st Qu.:20071   Sim:8671    \n#>  Median :0.0000   Median :1392.3   Median :33552               \n#>  Mean   :0.3398   Mean   :1281.7   Mean   :32721               \n#>  3rd Qu.:1.0000   3rd Qu.:1786.8   3rd Qu.:43584               \n#>  Max.   :1.0000   Max.   :2654.3   Max.   :73554\n```\n\n\n:::\n:::\n\n\n## 1a Regressão logística\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- glm(inadimplente ~ balanco + receita + estudante,data=conj_treinoS,family=binomial)\nsummary(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> \n#> Call:\n#> glm(formula = inadimplente ~ balanco + receita + estudante, family = binomial, \n#>     data = conj_treinoS)\n#> \n#> Coefficients:\n#>               Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept) -9.289e+00  2.112e-01 -43.990   <2e-16 ***\n#> balanco      7.111e-03  1.136e-04  62.586   <2e-16 ***\n#> receita     -3.103e-06  3.532e-06  -0.879     0.38    \n#> estudante   -9.580e-01  1.017e-01  -9.418   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 24081.3  on 17370  degrees of freedom\n#> Residual deviance:  8348.3  on 17367  degrees of freedom\n#> AIC: 8356.3\n#> \n#> Number of Fisher Scoring iterations: 7\n```\n\n\n:::\n\n```{.r .cell-code}\ncoef(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>   (Intercept)       balanco       receita     estudante \n#> -9.288540e+00  7.110668e-03 -3.103058e-06 -9.580370e-01\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(mod1)$coef\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>                  Estimate   Std. Error     z value     Pr(>|z|)\n#> (Intercept) -9.288540e+00 2.111528e-01 -43.9896601 0.000000e+00\n#> balanco      7.110668e-03 1.136140e-04  62.5862063 0.000000e+00\n#> receita     -3.103058e-06 3.532109e-06  -0.8785285 3.796570e-01\n#> estudante   -9.580370e-01 1.017207e-01  -9.4183074 4.584179e-21\n```\n\n\n:::\n:::\n\n\n## Avaliando o modelo novamente\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprop.table(table(conj_teste$inadimplente))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> \n#>        Nao        Sim \n#> 0.96603397 0.03396603\n```\n\n\n:::\n\n```{.r .cell-code}\np_chapeu <- predict(mod1, newdata = conj_teste, type = \"response\")\ny_chapeu <- ifelse(p_chapeu > 0.5, \"Sim\", \"Nao\") %>% factor(levels = levels(conj_teste$inadimplente))\nconfusionMatrix(y_chapeu, conj_teste$inadimplente, positive=\"Sim\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Confusion Matrix and Statistics\n#> \n#>           Reference\n#> Prediction Nao Sim\n#>        Nao 861   6\n#>        Sim 106  28\n#>                                          \n#>                Accuracy : 0.8881         \n#>                  95% CI : (0.8669, 0.907)\n#>     No Information Rate : 0.966          \n#>     P-Value [Acc > NIR] : 1              \n#>                                          \n#>                   Kappa : 0.2951         \n#>                                          \n#>  Mcnemar's Test P-Value : <2e-16         \n#>                                          \n#>             Sensitivity : 0.82353        \n#>             Specificity : 0.89038        \n#>          Pos Pred Value : 0.20896        \n#>          Neg Pred Value : 0.99308        \n#>              Prevalence : 0.03397        \n#>          Detection Rate : 0.02797        \n#>    Detection Prevalence : 0.13387        \n#>       Balanced Accuracy : 0.85696        \n#>                                          \n#>        'Positive' Class : Sim            \n#> \n```\n\n\n:::\n:::\n\n\n## Curva ROC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pROC)\np_chapeu_log <- predict(mod1, newdata = conj_teste, type = \"response\")\nhead(p_chapeu_log)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>           1           2           3           4           5           6 \n#> 0.088099402 0.002130191 0.019239847 0.070623827 0.133527974 0.005357011\n```\n\n\n:::\n\n```{.r .cell-code}\nroc_log <- roc(conj_teste$inadimplente ~ p_chapeu_log, plot = TRUE, print.auc=TRUE,\n                 legacy.axes=TRUE) \n```\n\n::: {.cell-output-display}\n![](Aula09A_files/figure-html/unnamed-chunk-7-1.png){width=90%}\n:::\n\n```{.r .cell-code}\nas.numeric(roc_log$auc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> [1] 0.9325081\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "Aula09A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}